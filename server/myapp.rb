# myapp.rb
require 'rubygems'
require 'sinatra'
require 'sinatra/chart_topper'

line "test" do

	size "400x225"

	graph.labels = {
		0 => '5/6',
		1 => '5/15',
		2 => '5/24',
		3 => '5/30'
	}  

	data "Apples", [1,2,3,4,5,6,7] 

end

line 'reports' do
	xAxis = "04:47,07:08,19:34,00:06,03:09,07:30,06:45,15:57,22:27,18:40,00:59,11:05,07:50,17:35,14:09,05:40,01:20,12:53,05:08,19:45,03:32,18:07,07:18,19:46,13:58,21:56,22:05,19:23,00:48,15:35,21:55,16:41,20:17,06:57,17:45,12:21,23:32,00:49,21:11,17:24,22:16,14:31,04:26,21:02,02:15,08:01,20:06,06:36,02:27,22:28,03:10,02:04,13:47,09:17,02:16,21:22,19:56,15:03,02:25,20:39,16:19,22:49,11:59,05:29,08:44,13:26,08:24,09:38,00:05,06:56,11:27,04:58,16:08,15:14,11:16,02:05,22:50,22:59,07:07,23:00,13:15,21:12,15:25,01:00,00:37,21:33,09:18,12:10,10:11,09:49,04:25,19:01,23:12,02:36,04:35,05:09,21:34,15:46,13:37,08:33,17:46,17:13,10:32,08:23,20:18,03:53,11:48,21:01,04:15,01:10,14:41,02:47,18:18,06:13,19:12,16:40,01:54,04:14,09:29,07:41,17:56,20:28,20:51,05:31,21:54,10:54,14:20,06:14,07:39,11:17,04:04,19:44,04:03,10:43,23:55,01:53,14:52,01:33,13:04,00:26,02:37,21:44,03:52,00:17,03:20,09:07,05:19,21:00,10:22,05:52,06:03,23:01,16:51,11:37,22:06,01:22,23:10,04:46,14:42,10:01,15:36,00:15,03:21,12:42,23:44,10:33,22:38,10:12,08:55,08:46,09:40,19:57,23:54,23:43,00:38,06:02,22:07,07:51,02:59,07:19,05:42,20:49,22:17,23:22,09:50,06:34,23:21,02:48,05:20,20:29,19:55,20:40,20:07,21:23,13:36,11:06,09:06,11:30,03:30,03:41,10:00,01:31,18:29,07:28,18:50,06:46,11:32,08:56,12:32,01:11,16:30,08:13,12:31,09:28,03:42,04:37,05:51,10:44,01:42,04:57,01:43,19:35,23:33,10:55,06:24,06:25,08:12,08:02,21:45,02:58,17:02,19:24,08:35,22:39,10:23,00:28,17:57,20:50,18:51".split(",")


	arr = [47.256,47.451,93.229,141.213,58.807,52.009,37.017,51.985,137.484,80.295,37.710,40.941,58.584,61.257,41.460,37.859,38.199,114.138,37.294,121.127,41.786,43.558,37.506,223.584,120.991,185.109,109.352,74.355,38.152,60.478,139.466,116.378,120.747,50.941,58.402,50.910,41.668,46.709,82.896,46.250,134.162,40.738,41.838,207.805,130.208,101.479,73.511,90.742,129.891,46.874,41.477,217.066,41.709,38.299,105.706,103.081,43.789,136.192,73.524,159.660,64.141,102.057,136.041,69.111,46.641,45.868,96.949,37.837,102.365,40.717,131.219,103.415,104.540,38.024,37.525,122.552,46.786,120.619,78.448,43.151,64.315,76.707,215.900,66.180,37.427,89.047,40.775,209.856,72.988,42.217,38.971,106.337,88.774,137.776,104.669,41.436,105.309,104.727,37.516,120.347,215.712,100.970,36.599,46.146,190.551,78.933,106.100,110.945,101.891,61.778,46.358,104.447,80.800,102.114,214.944,42.949,43.931,202.797,41.582,38.185,74.714,101.025,43.670,38.768,67.556,86.641,41.101,99.609,39.219,108.097,47.332,44.093,95.692,215.280,47.356,226.917,47.681,127.296,41.003,45.776,160.071,47.164,52.743,101.595,40.381,40.682,96.898,40.966,40.557,113.175,158.335,145.116,37.713,61.943,101.767,63.999,38.173,41.121,133.247,37.701,138.763,109.494,77.618,138.793,103.195,37.648,94.201,104.992,46.788,47.319,215.309,73.756,43.874,139.730,41.535,43.000,38.475,56.437,79.872,115.287,104.707,41.530,115.256,107.666,38.540,41.987,110.495,146.812,104.232,110.429,101.887,102.947,41.707,112.126,0,127.211,40.950,41.350,53.257,116.624,38.327,120.930,41.944,62.896,217.772,47.388,42.777,143.003,47.682,47.442,136.930,218.187,215.357,102.195,37.548,156.038,41.028,42.180,47.559,224.917,122.152,226.230,44.186,157.386,148.603,136.143,106.338,115.078,104.004,131.925,58.363,42.665,60.786,105.248,38.485,133.038,113.182,40.736,39.216,54.259,47.162,135.293,105.200,103.150,47.049,76.865,74.629,48.164,61.822,103.552,103.517,41.607,110.783,47.527,37.802,106.150,121.554,38.466,37.676,100.677,57.091,92.133,115.244,145.050,93.399,106.121,37.383,47.408,78.709,111.155,101.750,55.547,188.467,87.337,47.126,210.433,110.488,111.045,216.518,104.842,119.922,65.607,86.802,59.206,43.849,70.429,111.035,195.870,88.871,114.177,144.515,40.860]

	size "#{arr.size*4}x600"
	x_result = xAxis.inject({}) { |hash, i| hash.store(xAxis.index(i), i) ; hash   }
	graph.labels = x_result.select { |k, v|  (k % 111) == 0  }  
	data "reports", arr
end
